import{a as e,q as t}from"./query.bPXBOVUm.js";import{j as r,S as u,u as l,D as a,A as i,Q as n,E as o,q as d}from"./entry.GfyFTcIL.js";import"./preview.TXTNQZbS.js";const s=r({name:"ContentQuery",props:{path:{type:String,required:!1,default:void 0},only:{type:Array,required:!1,default:void 0},without:{type:Array,required:!1,default:void 0},where:{type:Object,required:!1,default:void 0},sort:{type:Object,required:!1,default:void 0},limit:{type:Number,required:!1,default:void 0},skip:{type:Number,required:!1,default:void 0},locale:{type:String,required:!1,default:void 0},find:{type:String,required:!1,default:void 0}},async setup(r){const{path:o,only:d,without:s,where:v,sort:p,limit:f,skip:h,locale:y,find:c}=u(r),m=l((()=>{var e;return null==(e=o.value)?void 0:e.includes("/_")})),w=!a().public.content.experimental.advanceQuery;i((()=>r),(()=>g()),{deep:!0});const q=e=>w?(null==e?void 0:e.surround)?e.surround:(null==e?void 0:e._id)||Array.isArray(e)?e:null==e?void 0:e.result:e.result,{data:S,refresh:g}=await e(`content-query-${n(r)}`,(()=>{let e;return e=o.value?t(o.value):t(),d.value&&(e=e.only(d.value)),s.value&&(e=e.without(s.value)),v.value&&(e=e.where(v.value)),p.value&&(e=e.sort(p.value)),f.value&&(e=e.limit(f.value)),h.value&&(e=e.skip(h.value)),y.value&&(e=e.where({_locale:y.value})),"one"===c.value?e.findOne().then(q):"surround"===c.value&&o.value?w?e.findSurround(o.value):e.withSurround(o.value).findOne().then(q):e.find().then(q)}));return{isPartial:m,data:S,refresh:g}},render(e){var t;const r=o(),{data:u,refresh:l,isPartial:a,path:i,only:n,without:s,where:v,sort:p,limit:f,skip:h,locale:y,find:c}=e,m={path:i,only:n,without:s,where:v,sort:p,limit:f,skip:h,locale:y,find:c};if("one"===m.find){if(!u&&(null==r?void 0:r["not-found"]))return r["not-found"]({props:m,...this.$attrs});if((null==r?void 0:r.empty)&&"markdown"===(null==u?void 0:u._type)&&!(null==(t=null==u?void 0:u.body)?void 0:t.children.length))return r.empty({props:m,...this.$attrs})}else if((!u||!u.length)&&(null==r?void 0:r["not-found"]))return r["not-found"]({props:m,...this.$attrs});if(null==r?void 0:r.default)return r.default({data:u,refresh:l,isPartial:a,props:m,...this.$attrs});return w="default",q={data:u,props:m,isPartial:a},d("pre",null,JSON.stringify({message:"You should use slots with <ContentQuery>!",slot:w,data:q},null,2));var w,q}});export{s as default};
